define(["app","directive/jrDatepicker","directive/jrDropdownButton","directive/jrPlaceholder"],function(app){app.registerController("roomAdminListl",["$scope","$rootScope","$http","$modal","$state","$stateParams","$filter","FileUploader",function($scope,$rootScope,$http,$modal,$state,$stateParams){function getData(params){$http.get("/com/manage/getAgentList",{params:$.extend({},params,{optDesc:"合作伙伴列表"})}).success(function(data){$scope.orders=data.object})}$scope.queryParams=$.extend({pageNum:1,querySize:10},$stateParams),$scope.queryOptions={isvalid:[{name:"全部",value:""},{name:"在职",value:"1"},{name:"离职",value:"0"}],companyStatus:[{value:"",name:"是否合作"},{value:"1",name:"合作中"},{value:"0",name:"合作终止"}],showSubCompany:[{value:"",name:"是否显示子公司"},{value:"0",name:"不显示"},{value:"1",name:"显示"}]},$scope.orders={pageNum:1},getData($scope.queryParams),$scope.addCompany=function(){window.open("#/company/add")},$scope.search=function(){$scope.queryParams.pageNum=1,getData($scope.queryParams)},$scope.fisuy=function(){},$scope.clearParams=function(){var pageSize=$scope.queryParams.pageSize;$scope.queryParams={pageNum:1,pageSize:pageSize}},$scope.look=function(event,order){_czc.logSend("房管员列表","查看");var modalModify=$modal.open({template:'<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">查看房管员信息</h3>\r\n</div>\r\n<form name="modifyForm" novalidate class="modify-agent-info">\r\n    <div class="modal-body">\r\n       <div class="modal-group">\r\n           <label for="agentName">姓名：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentName" id="agentName" value="" autocomplete="off" disabled ng-model="data.agentName"/>\r\n           </div>\r\n       </div>\r\n       <div class="modal-group">\r\n           <label for="agentPhone">手机号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentPhone" id="agentPhone" value="" autocomplete="off" disabled ng-model="data.agentPhone" maxlength="11"/>\r\n           </div>\r\n       </div>\r\n       <div class="modal-group">\r\n           <label for="agentIdCardText">身份证号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentIdCardText" id="agentIdCardText" value="" autocomplete="off" disabled ng-model="data.agentIdCardText" maxlength="18"/>\r\n           </div>\r\n       </div>\r\n       <div ng-if="appTestCompany == 0" class="modal-group">\r\n           <label for="wbUserName">58账号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="wbUserName" id="wbUserName" value="" autocomplete="off" disabled ng-model="data.wbUserName"/>\r\n           </div>\r\n       </div>\r\n        <div class="modal-group">\r\n            <label for="agentEnterprise">分店：</label>\r\n            <div class="group-item">\r\n                <input type="text" name="agentEnterprise" id="agentEnterprise" value="" disabled ng-model="data.agentEnterprise" maxlength="64" />\r\n            </div>\r\n        </div>\r\n        <div class="modal-group">\r\n            <label for="status">状态：</label>\r\n            <div class="group-item">\r\n                <input type="text" name="agentEnterprise" id="isOnWork" value="" disabled ng-model="data.isOnWork" maxlength="64" />\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <p class="error-info">{{errorInfo}}</p>\r\n        <button class="btn btn-cancel" ng-click="$dismiss(\'cancel\')" >关闭</button>\r\n    </div>\r\n</form>',controller:"ModalLook",backdrop:"static",resolve:{order:function(){return angular.copy(order)}}});modalModify.result.then(function(){$state.reload()})},app.registerController("ModalLook",function($rootScope,$scope,$modalInstance,order){$scope.data=order}),$scope.modify=function(event,order){_czc.logSend("房管员列表","修改");var modalModify=$modal.open({template:'<div class="modal-header">\r\n    <a href="javascript:void(0)" ng-click="$dismiss(\'cancel\')" class="modal-close"></a>\r\n    <h3 class="modal-title">修改房管员信息</h3>\r\n</div>\r\n<form name="modifyForm" novalidate class="modify-agent-info">\r\n    <div class="modal-body">\r\n       <div class="modal-group">\r\n           <label for="agentName">姓名：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentName" id="agentName" value="" autocomplete="off" required ng-model="data.agentName"/>\r\n           </div>\r\n       </div>\r\n       <div class="modal-group">\r\n           <label for="agentPhone">手机号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentPhone" id="agentPhone" value="" autocomplete="off" required ng-model="data.agentPhone" maxlength="11"/>\r\n           </div>\r\n       </div>\r\n       <div class="modal-group">\r\n           <label for="agentIdCardText">身份证号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="agentIdCardText" id="agentIdCardText" value="" autocomplete="off" required ng-model="data.agentIdCardText" maxlength="18"/>\r\n           </div>\r\n       </div>\r\n       <div ng-if="appTestCompany == 0" class="modal-group">\r\n           <label for="wbUserName">58账号：</label>\r\n           <div class="group-item">\r\n               <input type="text" name="wbUserName" id="wbUserName" value="" autocomplete="off" required ng-model="data.wbUserName"/>\r\n           </div>\r\n       </div>\r\n        <div class="modal-group">\r\n            <label for="agentEnterprise">分店：</label>\r\n            <div class="group-item">\r\n                <input type="text" name="agentEnterprise" id="agentEnterprise" value="" required ng-model="data.agentEnterprise" maxlength="64" />\r\n            </div>\r\n        </div>\r\n        <div class="modal-group">\r\n            <label for="status">状态：</label>\r\n            <div class="list-filter-col">\r\n                <jr-dropdown-button options="queryOptions.isOnWork" value="data.isOnWork" class="w180"></jr-dropdown-button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="modal-footer">\r\n        <p class="error-info">{{errorInfo}}</p>\r\n        <button class="btn btn-primary btn-submit" ng-disabled="modifyForm.$invalid" ng-click="submit()" type="submit">确定</button>\r\n        <button class="btn btn-cancel" ng-click="$dismiss(\'cancel\')" >取消</button>\r\n    </div>\r\n</form>',controller:"ModalModify",backdrop:"static",resolve:{order:function(){return angular.copy(order)}}});modalModify.result.then(function(){$state.reload()})},app.registerController("ModalModify",function($rootScope,$scope,$modalInstance,order){$scope.queryOptions={isOnWork:[{name:"在职",value:"1"},{name:"离职",value:"2"}]},$scope.appTestCompany=$rootScope.userInfo.appTestCompany,$scope.data=order,"离职"==$scope.data.isOnWork?$scope.data.isOnWork="2":"在职"==$scope.data.isOnWork&&($scope.data.isOnWork="1"),$scope.submit=function(){return $scope.errorInfo="",$scope.data.agentName?$scope.data.agentName.match(/^[\u4e00-\u9fa5·]{2,20}$/)?$scope.data.agentPhone?$scope.data.agentPhone.match(/^1\d{10}$/)?$scope.data.agentIdCardText?$scope.data.agentIdCardText.match(/^[1-9]\d{16}(\d|x|X)$/)?$scope.data.wbUserName||0!=$scope.appTestCompany?$scope.data.agentEnterprise?($scope.data.optDesc="修改房管员信息",$scope.data.agentId=$scope.data.id,void $http.post("/com/manage/updateAgent",$.param($scope.data)).success(function(data){data.success&&$modalInstance.close()})):($scope.errorInfo="分店不能为空",!1):($scope.errorInfo="58账号不能为空",!1):($scope.errorInfo="请填写正确的身份证号码",!1):($scope.errorInfo="身份证号不能为空",!1):($scope.errorInfo="请填写正确的手机号码，如：138********",!1):($scope.errorInfo="手机号不能为空",!1):($scope.errorInfo="请填写正确的中文姓名",!1):($scope.errorInfo="姓名不能为空",!1)}}),$scope.$watch("orders.pageNum",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageNum=newValue,void getData($scope.queryParams))}),$scope.$watch("orders.pageSize",function(newValue,oldValue){return newValue===oldValue?!1:($scope.queryParams.pageSize=newValue,void getData($scope.queryParams))})}])});